#!/bin/bash
if [[ "$OSTYPE" == "darwin"* ]]; then
    command=$(pmset -g batt | tail -1 | cut -f 2 | cut -d' ' -f 1,2 | sed 's/;//g')
else
  # Linux: use the first ACPI line that DOES NOT say "rate information unavailable"
  line=$(acpi -b | grep -v "rate information unavailable" | head -n1)
  # Fallback if all lines contain "rate information unavailable"
  if [ -z "$line" ]; then
    line=$(acpi -b | head -n1)
  fi

  # Extract percent and status
  percent=$(echo "$line" | awk -F', ' '{print $2}' | tr -d '%')
  status=$(echo "$line"  | awk -F': ' '{print $2}' | cut -d',' -f1 | tr '[:upper:]' '[:lower:]')

  command="$percent $status"
fi

battery_level=$(echo $command | cut -d' ' -f 1 | sed 's/%//g')
status=$(echo $command | cut -d' ' -f 2)

get_icon() {
  if [ $status == "charging" ] || [ $status == "charged" ]; then
    echo "#[fg=yellow] #[fg=green]"
  elif [ $battery_level -le 20 ]; then
    echo "#[fg=red] "
  elif [ $battery_level -le 40 ]; then
    echo "#[fg=yellow] "
  elif [ $battery_level -le 60 ]; then
    echo "#[fg=yellow] "
  elif [ $battery_level -le 80 ]; then
    echo "#[fg=green] "
  else
    echo "#[fg=green] "
  fi
}

echo $(get_icon)$battery_level%

